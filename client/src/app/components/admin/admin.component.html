<!-- client/src/app/components/admin/admin.component.html -->
<div class="admin-container">
    <div class="admin-header">
      <h2>User Management</h2>
      <p>Manage user accounts and permissions</p>
    </div>
    
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>
    
    <div class="admin-tools">
      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Search users..." 
          class="form-control"
        >
      </div>
    </div>
    
    <div *ngIf="isLoading" class="text-center mt-4">
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    
    <div *ngIf="!isLoading && filteredUsers.length === 0" class="no-users">
      <p>No users found matching your search criteria.</p>
    </div>
    
    <div *ngIf="!isLoading && filteredUsers.length > 0" class="users-table-container">
      <table class="table users-table">
        <thead>
          <tr>
            <th (click)="setSorting('username')" class="sortable">
              Username
              <i *ngIf="sortField === 'username'" class="fas" [ngClass]="{
                'fa-sort-up': sortDirection === 'asc',
                'fa-sort-down': sortDirection === 'desc'
              }"></i>
            </th>
            <th (click)="setSorting('email')" class="sortable">
              Email
              <i *ngIf="sortField === 'email'" class="fas" [ngClass]="{
                'fa-sort-up': sortDirection === 'asc',
                'fa-sort-down': sortDirection === 'desc'
              }"></i>
            </th>
            <th (click)="setSorting('role')" class="sortable">
              Role
              <i *ngIf="sortField === 'role'" class="fas" [ngClass]="{
                'fa-sort-up': sortDirection === 'asc',
                'fa-sort-down': sortDirection === 'desc'
              }"></i>
            </th>
            <th (click)="setSorting('status')" class="sortable">
              Status
              <i *ngIf="sortField === 'status'" class="fas" [ngClass]="{
                'fa-sort-up': sortDirection === 'asc',
                'fa-sort-down': sortDirection === 'desc'
              }"></i>
            </th>
            <th (click)="setSorting('createdAt')" class="sortable">
              Created
              <i *ngIf="sortField === 'createdAt'" class="fas" [ngClass]="{
                'fa-sort-up': sortDirection === 'asc',
                'fa-sort-down': sortDirection === 'desc'
              }"></i>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers">
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'badge-primary': user.role === 'admin',
                'badge-secondary': user.role === 'user'
              }">
                {{ user.role | titlecase }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="{
                'badge-success': user.isActive,
                'badge-danger': !user.isActive
              }">
                {{ user.isActive ? 'Active' : 'Disabled' }}
              </span>
            </td>
            <td>{{ user.createdAt | date }}</td>
            <td>
              <div class="user-actions">
                <button (click)="selectUserForEdit(user)" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button (click)="toggleUserStatus(user)" class="btn btn-sm" [ngClass]="{
                  'btn-outline-danger': user.isActive,
                  'btn-outline-success': !user.isActive
                }">
                  <i class="fas" [ngClass]="{
                    'fa-lock': user.isActive,
                    'fa-unlock': !user.isActive
                  }"></i>
                  {{ user.isActive ? 'Disable' : 'Enable' }}
                </button>
                <div class="dropdown">
                  <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="roleDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Role
                  </button>
                  <div class="dropdown-menu" aria-labelledby="roleDropdown">
                    <a class="dropdown-item" (click)="setUserRole(user, 'user')" [ngClass]="{'active': user.role === 'user'}">User</a>
                    <a class="dropdown-item" (click)="setUserRole(user, 'admin')" [ngClass]="{'active': user.role === 'admin'}">Admin</a>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Edit User Modal -->
    <div *ngIf="selectedUser" class="modal-overlay">
      <div class="edit-user-modal">
        <div class="modal-header">
          <h4>Edit User</h4>
          <button type="button" class="close-btn" (click)="cancelEdit()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="modal-body">
          <form [formGroup]="editUserForm" (ngSubmit)="updateUser()">
            <div class="form-group">
              <label for="username">Username</label>
              <input 
                type="text" 
                id="username" 
                formControlName="username" 
                class="form-control" 
                [ngClass]="{'is-invalid': editUserForm.get('username')?.touched && editUserForm.get('username')?.invalid}"
              >
              <div *ngIf="editUserForm.get('username')?.touched && editUserForm.get('username')?.invalid" class="invalid-feedback">
                <div *ngIf="editUserForm.get('username')?.errors?.['required']">Username is required</div>
                <div *ngIf="editUserForm.get('username')?.errors?.['minlength']">Username must be at least 3 characters</div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                class="form-control" 
                [ngClass]="{'is-invalid': editUserForm.get('email')?.touched && editUserForm.get('email')?.invalid}"
              >
              <div *ngIf="editUserForm.get('email')?.touched && editUserForm.get('email')?.invalid" class="invalid-feedback">
                <div *ngIf="editUserForm.get('email')?.errors?.['required']">Email is required</div>
                <div *ngIf="editUserForm.get('email')?.errors?.['email']">Please enter a valid email</div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="role">Role</label>
              <select 
                id="role" 
                formControlName="role" 
                class="form-control"
              >
                <option value="user">User</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            
            <div class="form-group">
              <div class="form-check">
                <input 
                  type="checkbox" 
                  id="isActive" 
                  formControlName="isActive" 
                  class="form-check-input"
                >
                <label class="form-check-label" for="isActive">Active Account</label>
              </div>
            </div>
            
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="editUserForm.invalid">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>